package game.ui;

import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.control.Button;
import javafx.scene.layout.VBox;
import javafx.scene.text.Font;
import javafx.scene.text.FontWeight;
import javafx.scene.text.Text;
import javafx.scene.text.TextAlignment;

/**
 * The {@code WinScreen} class displays the victory screen when the player wins the game.
 * <p>
 * This screen shows congratulations message, final score, and options to play again
 * or return to the main menu. Uses a modern color scheme with gold accents.
 * </p>
 */
public class WinScreen extends VBox {
    
    /** Text displaying the victory title */
    private Text titleText;
    
    /** Text displaying the final score */
    private Text scoreText;
    
    /** Button to play again */
    private Button playAgainButton;
    
    /** Button to return to main menu */
    private Button menuButton;
    
    /** Callback invoked when the player clicks "Play Again" */
    private Runnable onPlayAgainCallback;
    
    /** Callback invoked when the player clicks "Main Menu" */
    private Runnable onMenuCallback;
    
    /**
     * Constructs a new {@code WinScreen}.
     * <p>
     * Initializes all UI components, applies styling, and sets up the layout.
     * </p>
     */
    public WinScreen() {
        initializeComponents();
        styleComponents();
        layoutComponents();
    }
    
    /**
     * Updates the win screen with the final score.
     * 
     * @param finalScore the player's final score
     */
    public void setFinalScore(int finalScore) {
        scoreText.setText("Final Score: " + finalScore);
    }
    
    /**
     * Makes the win screen visible and brings it to the front.
     */
    public void show() {
        this.setVisible(true);
        this.toFront();
    }
    
    /**
     * Hides the win screen from view.
     */
    public void hide() {
        this.setVisible(false);
    }
    
    /**
     * Sets the callback to be invoked when the player clicks "Play Again".
     * 
     * @param callback the {@link Runnable} to execute when Play Again is clicked
     */
    public void setOnPlayAgain(Runnable callback) {
        this.onPlayAgainCallback = callback;
    }
    
    /**
     * Sets the callback to be invoked when the player clicks "Main Menu".
     * 
     * @param callback the {@link Runnable} to execute when Main Menu is clicked
     */
    public void setOnMenu(Runnable callback) {
        this.onMenuCallback = callback;
    }
    
    /**
     * Initializes all UI components.
     */
    private void initializeComponents() {
        titleText = new Text("VICTORY!");
        titleText.setTextAlignment(TextAlignment.CENTER);
        
        scoreText = new Text("Final Score: 0");
        scoreText.setTextAlignment(TextAlignment.CENTER);
        
        playAgainButton = new Button("Play Again");
        playAgainButton.setOnAction(event -> onPlayAgain());
        
        menuButton = new Button("Main Menu");
        menuButton.setOnAction(event -> onMenu());
    }
    
    /**
     * Applies styling to the win screen components.
     */
    private void styleComponents() {
        // Background - dark with gold accents
        this.setStyle("-fx-background-color: #1a1a2e; -fx-text-fill: #FFFFFF;");
        
        // Title - large, bold, gold color
        titleText.setFont(Font.font("System", FontWeight.BOLD, 48));
        titleText.setStyle("-fx-fill: #FFD700; -fx-effect: dropshadow(three-pass-box, rgba(255,215,0,0.8), 10, 0, 0, 0);");
        
        // Score - medium, white
        scoreText.setFont(Font.font("System", FontWeight.NORMAL, 24));
        scoreText.setStyle("-fx-fill: #FFFFFF;");
        
        // Buttons - styled with gold accents
        Font buttonFont = Font.font("System", FontWeight.BOLD, 18);
        playAgainButton.setFont(buttonFont);
        menuButton.setFont(buttonFont);
        
        playAgainButton.setPrefWidth(200);
        playAgainButton.setPrefHeight(45);
        menuButton.setPrefWidth(200);
        menuButton.setPrefHeight(45);
        
        playAgainButton.setStyle("-fx-background-color: #FFD700; -fx-text-fill: #1a1a2e; -fx-background-radius: 5;");
        menuButton.setStyle("-fx-background-color: #2a2a3e; -fx-text-fill: #FFFFFF; -fx-background-radius: 5; -fx-border-color: #FFD700; -fx-border-width: 2; -fx-border-radius: 5;");
        
        // Hover effects
        playAgainButton.setOnMouseEntered(e -> playAgainButton.setStyle("-fx-background-color: #FFED4E; -fx-text-fill: #1a1a2e; -fx-background-radius: 5;"));
        playAgainButton.setOnMouseExited(e -> playAgainButton.setStyle("-fx-background-color: #FFD700; -fx-text-fill: #1a1a2e; -fx-background-radius: 5;"));
        
        menuButton.setOnMouseEntered(e -> menuButton.setStyle("-fx-background-color: #3a3a4e; -fx-text-fill: #FFFFFF; -fx-background-radius: 5; -fx-border-color: #FFD700; -fx-border-width: 2; -fx-border-radius: 5;"));
        menuButton.setOnMouseExited(e -> menuButton.setStyle("-fx-background-color: #2a2a3e; -fx-text-fill: #FFFFFF; -fx-background-radius: 5; -fx-border-color: #FFD700; -fx-border-width: 2; -fx-border-radius: 5;"));
    }
    
    /**
     * Sets up the layout and spacing of components.
     */
    private void layoutComponents() {
        this.setAlignment(Pos.CENTER);
        this.setSpacing(30);
        this.setPadding(new Insets(40));
        this.setPrefWidth(600);
        this.setPrefHeight(400);
        
        this.getChildren().addAll(
            titleText,
            scoreText,
            playAgainButton,
            menuButton
        );
    }
    
    /**
     * Triggered when the Play Again button is clicked.
     */
    private void onPlayAgain() {
        if (onPlayAgainCallback != null) {
            onPlayAgainCallback.run();
        }
    }
    
    /**
     * Triggered when the Main Menu button is clicked.
     */
    private void onMenu() {
        if (onMenuCallback != null) {
            onMenuCallback.run();
        }
    }
}

